- name: Download Docker script
  ansible.builtin.get_url:
    url: https://get.docker.com
    dest: /home/pi/installDocker.sh
- name: Enable Docker script execute permission
  ansible.builtin.file:
    path: /home/pi/installDocker.sh
    owner: pi
    group: pi
    mode: 0755
- name: Execute Docker script
  ignore_errors: true
  ansible.builtin.command:
    cmd: bash /home/pi/installDocker.sh
- name: Delete piVPN script
  ansible.builtin.file:
    path: /home/pi/installDocker.sh
    state: absent
- name: Docker Compose
  ansible.builtin.apt:
    name: docker-compose
- name: Docker config folder
  ansible.builtin.file:
    path: /home/pi/docker/
    state: directory
- name: Copy docker files
  ansible.builtin.copy:
    src: ../docker/{{ item }}
    dest: /home/pi/docker_files/
  loop:
    - dockerfile.deluge
    - dockerfile.jellyfin
    - dockerfile.pihole
    - dockerfile.prowlarr
    - dockerfile.radarr
    - dockerfile.sonarr
- name: Docker compose
  ansible.builtin.command:
    cmd: docker-compose -f /home/pi/docker_files/{{ item }} up -d
  loop:
    - dockerfile.deluge
    - dockerfile.jellyfin
    - dockerfile.pihole
    - dockerfile.prowlarr
    - dockerfile.radarr
    - dockerfile.sonarr
- name: Delete Docker files
  ansible.builtin.file:
    path: /home/pi/docker_files/
    state: absent
